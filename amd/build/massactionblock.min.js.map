{"version":3,"sources":["../src/massactionblock.js"],"names":["sectionBoxes","isRebuilding","usedMoodleCssClasses","SECTION_NAME","MODULE_ID_PREFIX","SPINNER","DNDUPLOAD","cssIds","SELECT_ALL_LINK","DESELECT_ALL_LINK","HIDE_LINK","SHOW_LINK","MAKE_AVAILABLE_LINK","DUPLICATE_LINK","DELETE_LINK","MOVELEFT_LINK","MOVERIGHT_LINK","MOVETO_ICON_LINK","SECTION_SELECT","MOVETO_SELECT","BOX_ID_PREFIX","CHECKBOX_CLASS","HIDDEN_FIELD_REQUEST_INFORMATION","ACTION_FORM","constants","SECTION_SELECT_DESCRIPTION_VALUE","SECTION_NUMBER_ALL_PLACEHOLDER","actions","HIDE","SHOW","MAKE_AVAILABLE","DUPLICATE","DELETE","MOVE_LEFT","MOVE_RIGHT","MOVE_TO","init","courseId","pendingPromise","Pending","rebuildSections","observer","MutationObserver","mutations","filter","mutation","type","mutationsSection","addedNodes","length","every","target","classList","contains","mutationsActivities","removedNodes","allRemovedNodes","forEach","item","descendants","getAllDescendants","concat","node","nodeType","document","addEventListener","event","readyState","setTimeout","observe","body","subtree","childList","attributes","characterData","getElementById","setSectionSelection","submitAction","resolve","value","sectionNumber","boxIds","sectionId","j","push","boxId","box","i","checked","action","submitData","checkbox","moduleIds","moduleId","displayError","Str","get_string","moveToTarget","trim","JSON","stringify","submit","errorText","Promise","then","text","require","notification","alert","catch","promises","Ajax","call","methodname","args","all","data","nodes","allNodes","getDescendants","child","childNodes"],"mappings":"sjBAwBA,OACA,OACA,OACA,O,25BAEIA,CAAAA,CAAY,CAAG,E,CACfC,CAAY,G,CAEHC,CAAoB,CAAG,CAChCC,YAAY,CAAE,aADkB,CAEhCC,gBAAgB,CAAE,SAFc,CAGhCC,OAAO,CAAE,SAHuB,CAIhCC,SAAS,CAAE,0BAJqB,C,0BAO7B,GAAMC,CAAAA,CAAM,CAAG,CAClBC,eAAe,CAAE,oCADC,CAElBC,iBAAiB,CAAE,sCAFD,CAGlBC,SAAS,CAAE,8BAHO,CAIlBC,SAAS,CAAE,8BAJO,CAKlBC,mBAAmB,CAAE,uCALH,CAMlBC,cAAc,CAAE,mCANE,CAOlBC,WAAW,CAAE,gCAPK,CAQlBC,aAAa,CAAE,kCARG,CASlBC,cAAc,CAAE,mCATE,CAUlBC,gBAAgB,CAAE,gCAVA,CAWlBC,cAAc,CAAE,8CAXE,CAYlBC,aAAa,CAAE,8CAZG,CAalBC,aAAa,CAAE,mCAbG,CAclBC,cAAc,CAAE,2BAdE,CAelBC,gCAAgC,CAAE,kCAfhB,CAgBlBC,WAAW,CAAE,+BAhBK,CAAf,C,WAmBA,GAAMC,CAAAA,CAAS,CAAG,CACrBC,gCAAgC,CAAE,aADb,CAErBC,8BAA8B,CAAE,KAFX,CAAlB,C,iBAKDC,CAAAA,CAAO,CAAG,CACZC,IAAI,CAAE,MADM,CAEZC,IAAI,CAAE,MAFM,CAGZC,cAAc,CAAE,eAHJ,CAIZC,SAAS,CAAE,WAJC,CAKZC,MAAM,CAAE,QALI,CAMZC,SAAS,CAAE,UANC,CAOZC,UAAU,CAAE,WAPA,CAQZC,OAAO,CAAE,QARG,C,CAgBHC,CAAI,4CAAG,WAAMC,CAAN,+GAEVC,CAFU,CAEO,GAAIC,UAAJ,CAAY,uBAAZ,CAFP,CAGhBC,CAAe,CAACH,CAAD,CAAf,CAaMI,CAhBU,CAgBC,GAAIC,CAAAA,gBAAJ,CAAqB,SAASC,CAAT,CAAoB,CACtDA,CAAS,CAAGA,CAAS,CAACC,MAAV,CAAiB,SAAAC,CAAQ,QAAsB,WAAlB,GAAAA,CAAQ,CAACC,IAAb,CAAzB,CAAZ,CACA,GAAMC,CAAAA,CAAgB,CAAGJ,CAAS,CAC7BC,MADoB,CACb,SAAAC,CAAQ,QAAIA,CAAAA,CAAQ,CAACG,UAAT,EAAoD,CAA7B,CAAAH,CAAQ,CAACG,UAAT,CAAoBC,MAA/C,CADK,CAAzB,CAIA,GAAgC,CAA5B,GAAAF,CAAgB,CAACE,MAAjB,EACGF,CAAgB,CAACG,KAAjB,CAAuB,SAAAL,CAAQ,QAAIA,CAAAA,CAAQ,CAACM,MAAT,CAAgBC,SAAhB,CAA0BC,QAA1B,CAAmCnD,CAAoB,CAACC,YAAxD,CAAJ,CAA/B,CADP,CACkH,CAC9GqC,CAAe,CAACH,CAAD,CAAf,CAEA,MACH,CAXqD,GAchDiB,CAAAA,CAAmB,CAAGX,CAAS,CAChCC,MADuB,CAChB,SAAAC,CAAQ,QAAIA,CAAAA,CAAQ,CAACU,YAAT,EAAwD,CAA/B,CAAAV,CAAQ,CAACU,YAAT,CAAsBN,MAAnD,CADQ,CAd0B,CAgBlDO,CAAe,CAAG,EAhBgC,CAiBtDF,CAAmB,CAACG,OAApB,CAA4B,SAAAC,CAAI,CAAI,CAChC,GAAMC,CAAAA,CAAW,CAAGC,CAAiB,CAACF,CAAI,CAACH,YAAN,CAArC,CACA,GAAII,CAAJ,CAAiB,CACbH,CAAe,CAAGA,CAAe,CAACK,MAAhB,CAAuBF,CAAvB,CACrB,CACJ,CALD,EAOA,GAA6B,CAAzB,CAAAH,CAAe,CAACP,MAApB,CAAgC,CAE5BO,CAAe,CAACZ,MAAhB,CAAuB,SAAAkB,CAAI,QAAsB,EAAlB,GAAAA,CAAI,CAACC,QAAT,CAA3B,EAAoDN,OAApD,CAA4D,SAAAK,CAAI,CAAI,CAGhE,GAAIA,CAAI,CAACV,SAAL,EAAkBU,CAAI,CAACV,SAAL,CAAeC,QAAf,CAAwBnD,CAAoB,CAACG,OAA7C,CAAlB,EACGyD,CAAI,CAACV,SAAL,CAAeC,QAAf,CAAwBnD,CAAoB,CAACI,SAA7C,CADP,CACgE,CAC5DkC,CAAe,CAACH,CAAD,CAClB,CACJ,CAPD,CAQH,CACJ,CAnCgB,CAhBD,CAwDhB2B,QAAQ,CAACC,gBAAT,CAA0B,kBAA1B,CAA8C,SAAAC,CAAK,CAAI,CACnD,GAAgC,UAA5B,GAAAA,CAAK,CAACf,MAAN,CAAagB,UAAjB,CAA4C,CACxCC,UAAU,CAAC,iBAAM3B,CAAAA,CAAQ,CAAC4B,OAAT,CAAiBL,QAAQ,CAACM,IAA1B,CAAgC,CAC7CC,OAAO,GADsC,CAE7CC,SAAS,GAFoC,CAG7CC,UAAU,GAHmC,CAI7CC,aAAa,GAJgC,CAAhC,CAAN,CAAD,CAKN,GALM,CAMb,CACJ,CATD,EAWA,UAAAV,QAAQ,CAACW,cAAT,CAAwBpE,CAAM,CAACC,eAA/B,wBAAiDyD,gBAAjD,CAAkE,OAAlE,CACI,iBAAMW,CAAAA,CAAmB,IAAOpD,CAAS,CAACE,8BAAjB,CAAzB,CADJ,KAGA,UAAAsC,QAAQ,CAACW,cAAT,CAAwBpE,CAAM,CAACE,iBAA/B,wBAAmDwD,gBAAnD,CAAoE,OAApE,CACI,iBAAMW,CAAAA,CAAmB,IAAQpD,CAAS,CAACE,8BAAlB,CAAzB,CADJ,KAGA,UAAAsC,QAAQ,CAACW,cAAT,CAAwBpE,CAAM,CAACG,SAA/B,wBAA2CuD,gBAA3C,CAA4D,OAA5D,CACI,iBAAMY,CAAAA,CAAY,CAAClD,CAAO,CAACC,IAAT,CAAlB,CADJ,KAGA,UAAAoC,QAAQ,CAACW,cAAT,CAAwBpE,CAAM,CAACI,SAA/B,wBAA2CsD,gBAA3C,CAA4D,OAA5D,CACI,iBAAMY,CAAAA,CAAY,CAAClD,CAAO,CAACE,IAAT,CAAlB,CADJ,KAGA,UAAAmC,QAAQ,CAACW,cAAT,CAAwBpE,CAAM,CAACK,mBAA/B,wBAAqDqD,gBAArD,CAAsE,OAAtE,CACI,iBAAMY,CAAAA,CAAY,CAAClD,CAAO,CAACG,cAAT,CAAlB,CADJ,KAGA,UAAAkC,QAAQ,CAACW,cAAT,CAAwBpE,CAAM,CAACM,cAA/B,wBAAgDoD,gBAAhD,CAAiE,OAAjE,CACI,iBAAMY,CAAAA,CAAY,CAAClD,CAAO,CAACI,SAAT,CAAlB,CADJ,KAGA,UAAAiC,QAAQ,CAACW,cAAT,CAAwBpE,CAAM,CAACO,WAA/B,wBAA6CmD,gBAA7C,CAA8D,OAA9D,CACI,iBAAMY,CAAAA,CAAY,CAAClD,CAAO,CAACK,MAAT,CAAlB,CADJ,KAGA,UAAAgC,QAAQ,CAACW,cAAT,CAAwBpE,CAAM,CAACQ,aAA/B,wBAA+CkD,gBAA/C,CAAgE,OAAhE,CACI,iBAAMY,CAAAA,CAAY,CAAClD,CAAO,CAACM,SAAT,CAAlB,CADJ,KAGA,UAAA+B,QAAQ,CAACW,cAAT,CAAwBpE,CAAM,CAACS,cAA/B,wBAAgDiD,gBAAhD,CAAiE,OAAjE,CACI,iBAAMY,CAAAA,CAAY,CAAClD,CAAO,CAACO,UAAT,CAAlB,CADJ,KAGA,UAAA8B,QAAQ,CAACW,cAAT,CAAwBpE,CAAM,CAACU,gBAA/B,wBAAkDgD,gBAAlD,CAAmE,OAAnE,CACI,iBAAMY,CAAAA,CAAY,CAAClD,CAAO,CAACQ,OAAT,CAAlB,CADJ,KAGAG,CAAc,CAACwC,OAAf,GAjGgB,yCAAH,uD,UA2GV,GAAMF,CAAAA,CAAmB,CAAG,SAACG,CAAD,CAAQC,CAAR,CAA0B,CACzD,GAAMC,CAAAA,CAAM,CAAG,EAAf,CAEA,GAA6B,WAAzB,QAAOD,CAAAA,CAAP,EAAwCA,CAAa,GAAKxD,CAAS,CAACC,gCAAxE,CAA0G,CAEtG,MACH,CAHD,IAGO,IAA6B,WAAzB,QAAOuD,CAAAA,CAAP,EAAwCA,CAAa,GAAKxD,CAAS,CAACE,8BAAxE,CAAwG,CAE3G,IAAK,GAAMwD,CAAAA,CAAX,GAAwBlF,CAAAA,CAAxB,CAAsC,CAClC,IAAK,GAAImF,CAAAA,CAAC,CAAG,CAAb,CAAgBA,CAAC,CAAGnF,CAAY,CAACkF,CAAD,CAAZ,CAAwBjC,MAA5C,CAAoDkC,CAAC,EAArD,CAAyD,CACrDF,CAAM,CAACG,IAAP,CAAYpF,CAAY,CAACkF,CAAD,CAAZ,CAAwBC,CAAxB,EAA2BE,KAAvC,CACH,CACJ,CACJ,CAPM,IAOA,CAEHrF,CAAY,CAACgF,CAAD,CAAZ,CAA4BvB,OAA5B,CAAoC,SAAA6B,CAAG,QAAIL,CAAAA,CAAM,CAACG,IAAP,CAAYE,CAAG,CAACD,KAAhB,CAAJ,CAAvC,CACH,CAED,IAAK,GAAIE,CAAAA,CAAC,CAAG,CAAb,CAAgBA,CAAC,CAAGN,CAAM,CAAChC,MAA3B,CAAmCsC,CAAC,EAApC,CAAwC,CACpCvB,QAAQ,CAACW,cAAT,CAAwBM,CAAM,CAACM,CAAD,CAA9B,EAAmCC,OAAnC,CAA6CT,CAChD,CACJ,CArBM,C,2BA6BDF,CAAAA,CAAY,CAAG,SAACY,CAAD,CAAY,CAC7B,GAAMC,CAAAA,CAAU,CAAG,CACf,OAAUD,CADK,CAEf,UAAa,EAFE,CAAnB,CAMA,IAAK,GAAIT,CAAAA,CAAT,GAA0BhF,CAAAA,CAA1B,CAAwC,CACpC,IAAK,GAAIuF,CAAAA,CAAC,CAAG,CAAR,CACKI,CADV,CAAgBJ,CAAC,CAAGvF,CAAY,CAACgF,CAAD,CAAZ,CAA4B/B,MAAhD,CAAwDsC,CAAC,EAAzD,CAA6D,CACnDI,CADmD,CACxC3B,QAAQ,CAACW,cAAT,CAAwB3E,CAAY,CAACgF,CAAD,CAAZ,CAA4BO,CAA5B,EAA+BF,KAAvD,CADwC,CAEzD,GAAIM,CAAQ,CAACH,OAAb,CAAsB,CAClBE,CAAU,CAACE,SAAX,CAAqBR,IAArB,CAA0BpF,CAAY,CAACgF,CAAD,CAAZ,CAA4BO,CAA5B,EAA+BM,QAAzD,CACH,CACJ,CACJ,CAGD,GAAoC,CAAhC,GAAAH,CAAU,CAACE,SAAX,CAAqB3C,MAAzB,CAAuC,CACnC6C,CAAY,CAACC,CAAG,CAACC,UAAJ,CAAe,gBAAf,CAAiC,kBAAjC,CAAD,CAAZ,CACA,QACH,CAGD,OAAQP,CAAR,EACI,IAAK9D,CAAAA,CAAO,CAACC,IAAb,CACA,IAAKD,CAAAA,CAAO,CAACE,IAAb,CACA,IAAKF,CAAAA,CAAO,CAACG,cAAb,CACA,IAAKH,CAAAA,CAAO,CAACI,SAAb,CACA,IAAKJ,CAAAA,CAAO,CAACM,SAAb,CACA,IAAKN,CAAAA,CAAO,CAACO,UAAb,CACI,MAEJ,IAAKP,CAAAA,CAAO,CAACK,MAAb,CAEI,MAEJ,IAAKL,CAAAA,CAAO,CAACQ,OAAb,CAEIuD,CAAU,CAACO,YAAX,CAA0BjC,QAAQ,CAACW,cAAT,CAAwBpE,CAAM,CAACY,aAA/B,EAA8C4D,KAAxE,CACA,GAAuC,EAAnC,GAAAW,CAAU,CAACO,YAAX,CAAwBC,IAAxB,EAAJ,CAA2C,CACvCJ,CAAY,CAACC,CAAG,CAACC,UAAJ,CAAe,wBAAf,CAAyC,kBAAzC,CAAD,CAAZ,CACA,QACH,CACD,MAEJ,QACIF,CAAY,CAAC,mBAAqBL,CAArB,CAA8B,iBAA/B,CAAZ,CACA,SAxBR,CA2BAzB,QAAQ,CAACW,cAAT,CAAwBpE,CAAM,CAACe,gCAA/B,EAAiEyD,KAAjE,CAAyEoB,IAAI,CAACC,SAAL,CAAeV,CAAf,CAAzE,CACA1B,QAAQ,CAACW,cAAT,CAAwBpE,CAAM,CAACgB,WAA/B,EAA4C8E,MAA5C,GACA,QACH,C,CAEKP,CAAY,CAAG,SAACQ,CAAD,CAAe,CAChCC,OAAO,CAACzB,OAAR,CAAgB,CAACiB,CAAG,CAACC,UAAJ,CAAe,OAAf,CAAwB,MAAxB,CAAD,CAAkCM,CAAlC,CAA6CP,CAAG,CAACC,UAAJ,CAAe,MAAf,CAAuB,MAAvB,CAA7C,CAAhB,EAA8FQ,IAA9F,CAAmG,SAAAC,CAAI,CAAI,CACvGC,OAAO,CAAC,CAAC,mBAAD,CAAD,CAAwB,SAAUC,CAAV,CAAwB,CACnDA,CAAY,CAACC,KAAb,CAAmBH,CAAI,CAAC,CAAD,CAAvB,CAA4BA,CAAI,CAAC,CAAD,CAAhC,CAAqCA,CAAI,CAAC,CAAD,CAAzC,EAA8CD,IAA9C,GAAqDK,KAArD,EACH,CAFM,CAAP,CAGA,MAAO,KACV,CALD,EAKGA,KALH,EAMH,C,CAYKrE,CAAe,CAAG,SAACH,CAAD,CAAc,CAElC,GAAIpC,CAAJ,CAAkB,CACd,MACH,CAEDA,CAAY,GAAZ,CAGAmE,UAAU,CAAC,UAAM,CACb,GAAM0C,CAAAA,CAAQ,CAAGC,UAAKC,IAAL,CACb,CACI,CACIC,UAAU,CAAE,+BADhB,CAEIC,IAAI,CAAE,CAAC,SAAY7E,CAAb,CAFV,CADJ,CAKI,CACI4E,UAAU,CAAE,kCADhB,CAEIC,IAAI,CAAE,CAAC,SAAY7E,CAAb,CAFV,CALJ,CADa,CAAjB,CAYAkE,OAAO,CAACY,GAAR,CAAY,CAACL,CAAQ,CAAC,CAAD,CAAT,CAAcA,CAAQ,CAAC,CAAD,CAAtB,CAAZ,EAAwCN,IAAxC,CAA6C,SAAAY,CAAI,CAAI,CAEjDpH,CAAY,CAAG,cAAgBoH,CAAI,CAAC,CAAD,CAApB,CAAyBA,CAAI,CAAC,CAAD,CAA7B,CAAf,CACAnH,CAAY,GAAZ,CACA,QACH,CALD,EAKG4G,KALH,CAKS,UAAM,CACX5G,CAAY,GAAZ,CACA,QACH,CARD,CASH,CAtBS,CAsBP,GAtBO,CAuBb,C,CAQK2D,CAAiB,CAAG,SAACyD,CAAD,CAAW,CASjC,OARMC,CAAAA,CAAQ,CAAG,EAQjB,CAPMC,CAAc,CAAG,SAACzD,CAAD,CAAU,CAC7B,IAAK,GAAIyB,CAAAA,CAAC,CAAG,CAAR,CACKiC,CADV,CAAgBjC,CAAC,CAAGzB,CAAI,CAAC2D,UAAL,CAAgBxE,MAApC,CAA4CsC,CAAC,EAA7C,CAAiD,CACvCiC,CADuC,CAC/B1D,CAAI,CAAC2D,UAAL,CAAgBlC,CAAhB,CAD+B,CAE7CgC,CAAc,CAACC,CAAD,CAAd,CACAF,CAAQ,CAAClC,IAAT,CAAcoC,CAAd,CACH,CACJ,CACD,CAASrC,CAAC,CAAG,CAAb,CAAgBA,CAAC,CAAGkC,CAAK,CAACpE,MAA1B,CAAkCkC,CAAC,EAAnC,CAAuC,CACnCoC,CAAc,CAACF,CAAK,CAAClC,CAAD,CAAN,CACjB,CACD,MAAOmC,CAAAA,CACV,C","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Main module for the massaction block.\n *\n * @module     block_massaction/massactionblock\n * @copyright  2022 ISB Bayern\n * @author     Philipp Memmel\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport checkboxManager from './checkboxmanager';\nimport * as Str from 'core/str';\nimport Ajax from 'core/ajax';\nimport Pending from 'core/pending';\n\nlet sectionBoxes = {};\nlet isRebuilding = false;\n\nexport const usedMoodleCssClasses = {\n    SECTION_NAME: 'sectionname',\n    MODULE_ID_PREFIX: 'module-',\n    SPINNER: 'spinner',\n    DNDUPLOAD: 'dndupload-progress-outer',\n};\n\nexport const cssIds = {\n    SELECT_ALL_LINK: 'block-massaction-control-selectall',\n    DESELECT_ALL_LINK: 'block-massaction-control-deselectall',\n    HIDE_LINK: 'block-massaction-action-hide',\n    SHOW_LINK: 'block-massaction-action-show',\n    MAKE_AVAILABLE_LINK: 'block-massaction-action-makeavailable',\n    DUPLICATE_LINK: 'block-massaction-action-duplicate',\n    DELETE_LINK: 'block-massaction-action-delete',\n    MOVELEFT_LINK: 'block-massaction-action-moveleft',\n    MOVERIGHT_LINK: 'block-massaction-action-moveright',\n    MOVETO_ICON_LINK: 'block-massaction-action-moveto',\n    SECTION_SELECT: 'block-massaction-control-section-list-select',\n    MOVETO_SELECT: 'block-massaction-control-section-list-moveto',\n    BOX_ID_PREFIX: 'block-massaction-module-selector-',\n    CHECKBOX_CLASS: 'block-massaction-checkbox',\n    HIDDEN_FIELD_REQUEST_INFORMATION: 'block-massaction-control-request',\n    ACTION_FORM: 'block-massaction-control-form',\n};\n\nexport const constants = {\n    SECTION_SELECT_DESCRIPTION_VALUE: 'description',\n    SECTION_NUMBER_ALL_PLACEHOLDER: 'all',\n};\n\nconst actions = {\n    HIDE: 'hide',\n    SHOW: 'show',\n    MAKE_AVAILABLE: 'makeavailable',\n    DUPLICATE: 'duplicate',\n    DELETE: 'delete',\n    MOVE_LEFT: 'moveleft',\n    MOVE_RIGHT: 'moveright',\n    MOVE_TO: 'moveto',\n};\n\n/**\n * Initialize the mass-action block.\n *\n * @param {int} courseId the id of the current course.\n */\nexport const init = async(courseId) => {\n\n    const pendingPromise = new Pending('block_massaction/init');\n    rebuildSections(courseId);\n\n    /*\n     * This is definitely not what you want to do, but there is probably no better way:\n     * Observe all changes to the DOM of the body, and filter the correct mutations to get the following events:\n     * - Drag&Drop moving of a module\n     * - Drag&Drop upload of files\n     * - Change of section names\n     * - Drag&Drop moving of sections\n     * In all cases: get new information from webservice and re-render the plugin.\n     * Care: It doesn't react to renaming of modules, because it's only relevant for name/aria-label of the\n     * checkboxes. This slight imperfection is being ignored in favour of performance.\n     */\n    const observer = new MutationObserver(function(mutations) {\n        mutations = mutations.filter(mutation => mutation.type === 'childList');\n        const mutationsSection = mutations\n            .filter(mutation => mutation.addedNodes && mutation.addedNodes.length > 0);\n        // Typical MutationObserver record pattern if two sections have been swapped:\n        // The MutationRecord contains two newly added elements, both of them have a 'sectionname' class.\n        if (mutationsSection.length === 2\n            && mutationsSection.every(mutation => mutation.target.classList.contains(usedMoodleCssClasses.SECTION_NAME))) {\n            rebuildSections(courseId);\n            // We already triggered the rebuild, no need to search for further mutation observer events.\n            return;\n        }\n\n        // Build the node tree recursively to later check if some of the objects has been removed.\n        const mutationsActivities = mutations\n            .filter(mutation => mutation.removedNodes && mutation.removedNodes.length > 0);\n        let allRemovedNodes = [];\n        mutationsActivities.forEach(item => {\n            const descendants = getAllDescendants(item.removedNodes);\n            if (descendants) {\n                allRemovedNodes = allRemovedNodes.concat(descendants);\n            }\n        });\n\n        if (allRemovedNodes.length > 0) {\n            // First remove all text nodes (nodeType 3).\n            allRemovedNodes.filter(node => node.nodeType !== 3).forEach(node => {\n                // Then check if a spinner has been removed (indicates end of drag'n'drop move and changing of section name) or\n                // if a dndupload-progress-outer item has been removed -> indicates a finished drag'n'drop file upload.\n                if (node.classList && node.classList.contains(usedMoodleCssClasses.SPINNER)\n                    || node.classList.contains(usedMoodleCssClasses.DNDUPLOAD)) {\n                    rebuildSections(courseId);\n                }\n            });\n        }\n    });\n\n    // Activate the mutation observer for tracking drag'n'drop changes.\n    // Unfortunately there seems to be some moodle JS which is loaded AFTER the readystatechange event has been set to 'completed'.\n    // Thus, we have to go for an additional timeout to wait for it.\n    document.addEventListener('readystatechange', event => {\n        if (event.target.readyState === 'complete') {\n            setTimeout(() => observer.observe(document.body, {\n                subtree: true,\n                childList: true,\n                attributes: false,\n                characterData: false\n            }), 1000);\n        }\n    });\n\n    document.getElementById(cssIds.SELECT_ALL_LINK)?.addEventListener('click',\n        () => setSectionSelection(true, constants.SECTION_NUMBER_ALL_PLACEHOLDER), false);\n\n    document.getElementById(cssIds.DESELECT_ALL_LINK)?.addEventListener('click',\n        () => setSectionSelection(false, constants.SECTION_NUMBER_ALL_PLACEHOLDER), false);\n\n    document.getElementById(cssIds.HIDE_LINK)?.addEventListener('click',\n        () => submitAction(actions.HIDE), false);\n\n    document.getElementById(cssIds.SHOW_LINK)?.addEventListener('click',\n        () => submitAction(actions.SHOW), false);\n\n    document.getElementById(cssIds.MAKE_AVAILABLE_LINK)?.addEventListener('click',\n        () => submitAction(actions.MAKE_AVAILABLE), false);\n\n    document.getElementById(cssIds.DUPLICATE_LINK)?.addEventListener('click',\n        () => submitAction(actions.DUPLICATE), false);\n\n    document.getElementById(cssIds.DELETE_LINK)?.addEventListener('click',\n        () => submitAction(actions.DELETE), false);\n\n    document.getElementById(cssIds.MOVELEFT_LINK)?.addEventListener('click',\n        () => submitAction(actions.MOVE_LEFT), false);\n\n    document.getElementById(cssIds.MOVERIGHT_LINK)?.addEventListener('click',\n        () => submitAction(actions.MOVE_RIGHT), false);\n\n    document.getElementById(cssIds.MOVETO_ICON_LINK)?.addEventListener('click',\n        () => submitAction(actions.MOVE_TO), false);\n\n    pendingPromise.resolve();\n};\n\n/**\n * Select all module checkboxes in section(s).\n *\n * @param {boolean} value the checked value to set the checkboxes to\n * @param {string} sectionNumber the section number of the section which all modules should be checked/unchecked. Use \"all\" to\n * select/deselect modules in all sections.\n */\nexport const setSectionSelection = (value, sectionNumber) => {\n    const boxIds = [];\n\n    if (typeof sectionNumber !== 'undefined' && sectionNumber === constants.SECTION_SELECT_DESCRIPTION_VALUE) {\n        // Description placeholder has been selected, do nothing.\n        return;\n    } else if (typeof sectionNumber !== 'undefined' && sectionNumber === constants.SECTION_NUMBER_ALL_PLACEHOLDER) {\n        // See if we are toggling all sections.\n        for (const sectionId in sectionBoxes) {\n            for (let j = 0; j < sectionBoxes[sectionId].length; j++) {\n                boxIds.push(sectionBoxes[sectionId][j].boxId);\n            }\n        }\n    } else {\n        // We select all boxes of the given section.\n        sectionBoxes[sectionNumber].forEach(box => boxIds.push(box.boxId));\n    }\n    // Un/check the boxes.\n    for (let i = 0; i < boxIds.length; i++) {\n        document.getElementById(boxIds[i]).checked = value;\n    }\n};\n\n/**\n * Submit the selected action to server.\n *\n * @param {string} action\n * @return {boolean} true if action was successful, false otherwise\n */\nconst submitAction = (action) => {\n    const submitData = {\n        'action': action,\n        'moduleIds': []\n    };\n\n    // Get the checked box IDs.\n    for (let sectionNumber in sectionBoxes) {\n        for (let i = 0; i < sectionBoxes[sectionNumber].length; i++) {\n            const checkbox = document.getElementById(sectionBoxes[sectionNumber][i].boxId);\n            if (checkbox.checked) {\n                submitData.moduleIds.push(sectionBoxes[sectionNumber][i].moduleId);\n            }\n        }\n    }\n\n    // Verify that at least one checkbox is checked.\n    if (submitData.moduleIds.length === 0) {\n        displayError(Str.get_string('noitemselected', 'block_massaction'));\n        return false;\n    }\n\n    // Prep the submission.\n    switch (action) {\n        case actions.HIDE:\n        case actions.SHOW:\n        case actions.MAKE_AVAILABLE:\n        case actions.DUPLICATE:\n        case actions.MOVE_LEFT:\n        case actions.MOVE_RIGHT:\n            break;\n\n        case actions.DELETE:\n            // Confirm.\n            break;\n\n        case actions.MOVE_TO:\n            // Get the target section.\n            submitData.moveToTarget = document.getElementById(cssIds.MOVETO_SELECT).value;\n            if (submitData.moveToTarget.trim() === '') {\n                displayError(Str.get_string('nomovingtargetselected', 'block_massaction'));\n                return false;\n            }\n            break;\n\n        default:\n            displayError('Unknown action: ' + action + '. Coding error.');\n            return false;\n    }\n    // Set the form value and submit.\n    document.getElementById(cssIds.HIDDEN_FIELD_REQUEST_INFORMATION).value = JSON.stringify(submitData);\n    document.getElementById(cssIds.ACTION_FORM).submit();\n    return true;\n};\n\nconst displayError = (errorText) => {\n    Promise.resolve([Str.get_string('error', 'core'), errorText, Str.get_string('back', 'core')]).then(text => {\n        require(['core/notification'], function (notification) {\n            notification.alert(text[0], text[1], text[2]).then().catch();\n        });\n        return null;\n    }).catch();\n};\n\n/**\n * This method rebuilds the data structure stored in 'sections'. This is neccessary whenever a drag'n'drop\n * operation is being done in the course which leads to a change of the section information. It calls a\n * webservice to retrieve the updated section (and modules) data.\n *\n * This method implements a mechanism to only send a single request at once. Multiple requests arriving while\n * the promise for the request hasn't been resolved yet are being ignored.\n *\n * @param {number} courseId the course id of the course to get the section information from the webservice\n */\nconst rebuildSections = (courseId) => {\n    // Only rebuild if we're not yet trying to get the new data from the webservice.\n    if (isRebuilding) {\n        return;\n    }\n\n    isRebuilding = true;\n    // Setting a hardcoded timeout like this is ugly, but due to a hardcoded timeout in the yui library\n    // there probably is no better way to handle this.\n    setTimeout(() => {\n        const promises = Ajax.call(\n            [\n                {\n                    methodname: 'block_massaction_get_sections',\n                    args: {'courseId': courseId},\n                },\n                {\n                    methodname: 'block_massaction_get_modulesinfo',\n                    args: {'courseId': courseId},\n                }\n            ]);\n\n        Promise.all([promises[0], promises[1]]).then(data => {\n            // The array data[0] contains sections information, data[1] the module names.\n            sectionBoxes = checkboxManager(data[0], data[1]);\n            isRebuilding = false;\n            return true;\n        }).catch(() => {\n            isRebuilding = false;\n            return false;\n        });\n    }, 1000);\n};\n\n/**\n * Utility method to get an array of all descendent nodes of a given nodeList recursively.\n *\n * @param {NodeList} nodes The NodeList to convert to a flat array of nodes.\n * @return {[Node]} array of recursively found nodes.\n */\nconst getAllDescendants = (nodes) => {\n    const allNodes = [];\n    const getDescendants = (node) => {\n        for (let i = 0; i < node.childNodes.length; i++) {\n            const child = node.childNodes[i];\n            getDescendants(child);\n            allNodes.push(child);\n        }\n    };\n    for (let j = 0; j < nodes.length; j++) {\n        getDescendants(nodes[j]);\n    }\n    return allNodes;\n};\n"],"file":"massactionblock.min.js"}